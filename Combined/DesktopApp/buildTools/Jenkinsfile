pipeline {
    agent any
    options {
        skipDefaultCheckout()
    }
    stages {
        stage('Prepare build folder') {
            steps {
                cleanWs()
            }
        }

        stage('Get source code') {
            steps {
                checkout scm
            }
        }

        // stage('Build Python folder implementation') {
        //     steps {
        //         dir('./Python/pyinstaller') {
        //             sh '/home/matt/.venvs/CXR_env/bin/pyinstaller folder.spec'
        //         }
        //         dir('./Python/builds') {
        //             sh 'zip -r dist_folder.zip dist_folder'
        //         }
        //     }
        // }

        // stage('Build Python file implementation') {
        //     steps {
        //         dir('./Python/pyinstaller') {
        //             sh '/home/matt/.venvs/CXR_env/bin/pyinstaller one_file.spec'
        //         }
        //         dir('./Python/builds') {
        //             sh 'zip -r dist_one_file.zip dist_one_file'
        //         }
        //     }
        // }

        // stage('Build C++ implementation') {
        //     steps {
        //         sh 'mkdir ./Cpp/build'
        //         dir('./Cpp/build') {
        //             sh '/usr/lib/qt5/bin/qmake /home/matt/Documents/CXR_View_Classification/Cpp/CXR_classify/CXR_classify.pro -spec linux-g++ CONFIG+=debug'
        //             sh '/usr/bin/make -j6'
        //         }
        //     }
        // }

        // stage('Build shared libraries') {
        //     steps {
        //         sh 'mkdir ./Combined/DesktopApp/build'
        //         dir('./Combined/DesktopApp/build') {
        //             sh 'cmake ../src'
        //             sh 'cmake --build .'
        //         }
        //     }
        // }

        stage('Clean up') {
            steps {
                sh 'find . -name "*@tmp" -type d -delete'
            }
        }

        stage('Set up VM') {
            environment {
                VMREST_CREDS = credentials('vmrest-credentials-for-cxr-classify')
                VM_SOURCE = "/home/matt/vmwareSnapshots/Ubuntu"
                VM_DESTINATION = "/home/matt/vmware/Ubuntu/"
                SHARED_FOLDER_HOST_PATH = "/home/matt/SharedFolder_Host"
            }
            steps {
                sh "chmod u+x ./miscellaneous/installation.sh"
                sh "./miscellaneous/installation.sh"
            }
        }
    }
}